.d-flex.justify-content-between.align-items-center.mb-4
  %h1.h3.mb-0
    %i.bi.bi-tag-fill.me-2
    Listings
  .d-flex.gap-2
    = link_to listings_path, class: "btn btn-outline-secondary" do
      %i.bi.bi-eye.me-1
      Public View
    = link_to new_admin_listing_path, class: "btn btn-primary" do
      %i.bi.bi-plus-lg.me-1
      New Listing

.card.shadow-sm.border-0.mb-4
  .card-header.fw-semibold Filter Records
  .card-body
    = search_form_for @q, url: admin_listings_path, html: { class: "row g-2 align-items-end" } do |f|
      .col-md-2
        = f.label :lot_id_eq, "Lot", class: "form-label form-label-sm"
        = f.select :lot_id_eq, @lots.map { [it.number.present? ? "#{it.number} — #{it.name}" : it.name, it.id] },
            { include_blank: "Any" }, class: "form-select form-select-sm"
      .col-md-4
        = f.label :name_cont, "Name", class: "form-label form-label-sm"
        = f.search_field :name_cont, class: "form-control form-control-sm", placeholder: "Search by name..."
      .col-md-2
        = f.label :listing_type_eq, "Type", class: "form-label form-label-sm"
        = f.select :listing_type_eq, Listing.listing_types.keys.map { [it.humanize, it] }, { include_blank: "Any" }, class: "form-select form-select-sm"
      .col-md-4
        = f.label :owner_email_address_cont, "Owner Email", class: "form-label form-label-sm"
        = f.search_field :owner_email_address_cont, class: "form-control form-control-sm", placeholder: "Search by owner email..."
      .col-md-2
        = f.label :categories_id_eq, "Category", class: "form-label form-label-sm"
        = f.select :categories_id_eq, @categories.map { [it.name, it.id] }, { include_blank: "Any" }, class: "form-select form-select-sm"
      .col-md-2
        = f.label :state_eq, "State", class: "form-label form-label-sm"
        = f.select :state_eq, Listing.states.keys.map { [it.humanize, it] }, { include_blank: "Any" }, class: "form-select form-select-sm"
      .col-md-2
        = f.label :published_eq, "Published", class: "form-label form-label-sm"
        = f.select :published_eq, [["Published", true], ["Unpublished", false]], { include_blank: "Any" }, class: "form-select form-select-sm"
      .col-auto
        = f.submit "Search", class: "btn btn-primary btn-sm"
      .col-auto
        = link_to "Clear", admin_listings_path, class: "btn btn-outline-secondary btn-sm"
%div{data: { controller: "bulk-select" }}
  .card.shadow-sm.border-0.mb-3{data: { "bulk-select-target": "actionBar" }, hidden: true}
    .card-body
      .d-flex.align-items-center.gap-3.flex-wrap
        .form-check.mb-0
          %input.form-check-input{type: "checkbox", data: { "bulk-select-target": "selectAll", action: "change->bulk-select#toggleAll" }}
          %label.form-check-label Select all
        %span.text-muted.small{data: { "bulk-select-target": "count" }} 0 selected
        = form_with url: admin_auction_listings_path, method: :post, data: { "bulk-select-target": "form", turbo: false } do |f|
          .d-flex.gap-2.flex-wrap
            = f.select :auction_id, @auctions.map { [_1.name, _1.id] },
                { prompt: "Select auction…" },
                class: "form-select form-select-sm w-auto"
            %button.btn.btn-primary.btn-sm{type: "button", data: { action: "click->bulk-select#submit" }} Add to Auction
  %div{data: { controller: "infinite-scroll" }}
    = render_listings_table(listings: @listings, q: @q)
    = render "admin/listings/sentinel", pagy: @pagy, q: params[:q]
