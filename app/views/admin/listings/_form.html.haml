= form_with model: [:admin, listing], class: "needs-validation" do |f|
  - if listing.errors.any?
    .alert.alert-danger
      %h5.alert-heading
        %i.bi.bi-exclamation-triangle-fill.me-2
        = pluralize(listing.errors.count, "error")
        prohibited this listing from being saved:
      %ul.mb-0
        - listing.errors.full_messages.each do |message|
          %li= message

  .mb-3
    = f.label :name, class: "form-label"
    = f.text_field :name, class: "form-control #{'is-invalid' if listing.errors[:name].any?}", required: true
    - if listing.errors[:name].any?
      .invalid-feedback= listing.errors[:name].to_sentence

  .mb-3
    = f.label :price, class: "form-label"
    .input-group
      %span.input-group-text $
      = f.text_field :price, class: "form-control #{'is-invalid' if listing.errors[:price_cents].any?}", required: true, value: listing.price&.to_f
    - if listing.errors[:price_cents].any?
      .invalid-feedback.d-block= listing.errors[:price_cents].to_sentence

  .mb-3
    = f.label :owner_id, "Owner", class: "form-label"
    = f.collection_select :owner_id, User.order(:email_address), :id, :email_address,
      { prompt: "Select an owner..." },
      { class: "form-select #{'is-invalid' if listing.errors[:owner].any?}", required: true }
    - if listing.errors[:owner].any?
      .invalid-feedback= listing.errors[:owner].to_sentence

  .mb-3
    = f.label :description, class: "form-label"
    = f.rich_text_area :description, class: "form-control #{'is-invalid' if listing.errors[:description].any?}"
    - if listing.errors[:description].any?
      .invalid-feedback.d-block= listing.errors[:description].to_sentence

  .mb-3
    = f.label :images, class: "form-label"
    = f.file_field :images, multiple: true, class: "form-control #{'is-invalid' if listing.errors[:images].any?}", accept: "image/*"
    - if listing.errors[:images].any?
      .invalid-feedback= listing.errors[:images].to_sentence
    - if listing.images.attached?
      %ul.list-unstyled.mt-2.mb-0.small.text-muted
        - listing.images_attachments.each do |attachment|
          %li.d-flex.align-items-center.gap-1
            %i.bi.bi-image
            = attachment.filename
            = link_to admin_listing_attachment_path(listing, attachment),
              data: { turbo_method: :delete, turbo_confirm: "Remove #{attachment.filename}?" },
              class: "text-danger ms-1",
              aria: { label: "Remove #{attachment.filename}" } do
              %i.bi.bi-x-lg

  .mb-3
    = f.label :videos, class: "form-label"
    = f.file_field :videos, multiple: true, class: "form-control #{'is-invalid' if listing.errors[:videos].any?}", accept: "video/*"
    - if listing.errors[:videos].any?
      .invalid-feedback= listing.errors[:videos].to_sentence
    - if listing.videos.attached?
      %ul.list-unstyled.mt-2.mb-0.small.text-muted
        - listing.videos_attachments.each do |attachment|
          %li.d-flex.align-items-center.gap-1
            %i.bi.bi-camera-video
            = attachment.filename
            = link_to admin_listing_attachment_path(listing, attachment),
              data: { turbo_method: :delete, turbo_confirm: "Remove #{attachment.filename}?" },
              class: "text-danger ms-1",
              aria: { label: "Remove #{attachment.filename}" } do
              %i.bi.bi-x-lg

  .mb-3.form-check
    = f.check_box :published, class: "form-check-input"
    = f.label :published, class: "form-check-label"

  .d-flex.gap-2
    = f.submit class: "btn btn-primary"
    = link_to "Cancel", admin_listings_path, class: "btn btn-outline-secondary"
