- content_for :title, @listing.name

:ruby
  has_images = @listing.images.attached?
  has_videos = @listing.videos.attached?
  media_count = @listing.images.count + @listing.videos.count

= link_to listings_path, class: "btn btn-outline-secondary btn-sm mb-4" do
  %i.bi.bi-arrow-left.me-1
  Back to listings

.row.g-4.g-lg-5.align-items-start
  .col-lg-7
    - if has_images || has_videos
      .position-relative{ data: { controller: "image-zoom listing-carousel" } }
        #listing-carousel.carousel.slide{ data: { bs_ride: "false", "listing-carousel-target": "carousel" } }
          .carousel-inner{ data: { action: "mousemove->image-zoom#track" } }
            - slide = 0
            - @listing.images.each do |image|
              .carousel-item{ class: slide.zero? ? "active" : "" }
                = image_tag image, class: "d-block w-100 rounded-3 object-fit-cover", style: "height: 480px"
              - slide += 1
            - @listing.videos.each do |video|
              .carousel-item{ class: slide.zero? ? "active" : "" }
                %video.d-block.w-100.rounded-3{ controls: true, style: "height: 480px; object-fit: cover" }
                  %source{ src: url_for(video) }
              - slide += 1
          - if media_count > 1
            %button.carousel-control-prev{ type: "button", data: { bs_target: "#listing-carousel", bs_slide: "prev" } }
              %span.carousel-control-prev-icon{ aria: { hidden: "true" } }
              %span.visually-hidden Previous
            %button.carousel-control-next{ type: "button", data: { bs_target: "#listing-carousel", bs_slide: "next" } }
              %span.carousel-control-next-icon{ aria: { hidden: "true" } }
              %span.visually-hidden Next
        .position-absolute.bottom-0.end-0.p-2{ style: "z-index: 10", data: { "listing-carousel-target": "zoomControls" } }
          .d-flex.align-items-center.gap-1
            %span.badge.text-bg-dark.font-monospace{ data: { image_zoom_target: "level" }, style: "visibility: hidden" } 100%
            %button.btn.btn-sm.btn-dark.opacity-75{ type: "button", title: "Zoom out", data: { action: "image-zoom#zoomOut" } }
              %i.bi.bi-zoom-out
            %button.btn.btn-sm.btn-dark.opacity-75{ type: "button", title: "Reset", data: { action: "image-zoom#reset" } }
              %i.bi.bi-arrow-counterclockwise
            %button.btn.btn-sm.btn-dark.opacity-75{ type: "button", title: "Zoom in", data: { action: "image-zoom#zoomIn" } }
              %i.bi.bi-zoom-in

      - if media_count > 1
        .d-flex.flex-wrap.gap-2.mt-3
          - thumb_index = 0
          - @listing.images.each do |image|
            = image_tag image,
              class: "rounded-2 object-fit-cover flex-shrink-0",
              style: "width: 76px; height: 76px; cursor: pointer; outline: 2px solid transparent",
              data: { bs_target: "#listing-carousel", bs_slide_to: thumb_index }
            - thumb_index += 1
          - @listing.videos.each do |video|
            .rounded-2.bg-dark.d-flex.align-items-center.justify-content-center.flex-shrink-0{
              style: "width: 76px; height: 76px; cursor: pointer",
              data: { bs_target: "#listing-carousel", bs_slide_to: thumb_index } }
              %i.bi.bi-play-circle-fill.text-white.fs-3
            - thumb_index += 1
    - elsif @listing.lot&.listing_placeholder&.attached?
      = image_tag @listing.lot.listing_placeholder, class: "d-block w-100 rounded-3 object-fit-cover", style: "height: 480px"
    - else
      .rounded-3.bg-light.d-flex.align-items-center.justify-content-center{ style: "height: 480px" }
        %i.bi.bi-image.text-muted{ style: "font-size: 5rem" }

  .col-lg-5
    .position-sticky{ style: "top: 1.5rem" }
      %h1.fw-bold.mb-1= @listing.name
      %p.fs-2.text-primary.fw-semibold.mb-2= number_to_currency(@listing.price)
      %p.text-muted.small.mb-4
        %i.bi.bi-box-seam.me-1
        = pluralize(@listing.quantity, "available")
      %hr.mb-4
      - if Current.user
        - if @cart_item
          = button_to cart_item_path(@cart_item), method: :delete, class: "btn btn-outline-secondary w-100 mb-4", form: { data: { turbo_confirm: "Remove from cart?" } } do
            %i.bi.bi-cart-check.me-2
            In Cart
        - else
          = button_to cart_items_path, params: { listing_id: @listing.id }, class: "btn btn-primary w-100 mb-4" do
            %i.bi.bi-cart-plus.me-2
            Add to Cart
      - else
        = link_to new_session_path, class: "btn btn-outline-primary w-100 mb-4" do
          %i.bi.bi-cart-plus.me-2
          Sign in to add to cart
      .listing-description
        = @listing.description

- if @listing.documents.attached?
  %hr.mt-5
  %h2.h5.fw-semibold.mb-3
    %i.bi.bi-folder2-open.me-2
    Documents
  .d-flex.flex-wrap.gap-3
    - @listing.documents.each do |doc|
      = link_to rails_blob_path(doc, disposition: "attachment"), class: "text-decoration-none" do
        .d-flex.flex-column.align-items-center.justify-content-center.border.rounded-3.p-3.bg-body-tertiary{ style: "width: 120px; min-height: 110px" }
          %i.bi{ class: [document_icon_class(doc.content_type), "text-secondary"].compact_blank.join(" "), style: "font-size: 2.5rem" }
          %span.text-center.text-body.small.mt-2.lh-sm{ style: "word-break: break-all; max-width: 96px" }= doc.filename.to_s.truncate(32)
