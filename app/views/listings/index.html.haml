- set_meta_tags title: "Listings",
    description: "Browse all listings for sale.",
    og: { title: "Listings", description: "Browse all listings for sale." }

%div{ data: { controller: "view-toggle" } }
  .d-flex.justify-content-between.align-items-center.mb-3
    %h1.h3.mb-0 Listings
    .d-flex.gap-2.align-items-center
      = form_with url: listings_path, method: :get do |f|
        = f.hidden_field :tab, value: @tab
        = f.select :category_id, @categories.map { [it.name, it.hashid] },
          { include_blank: "All Categories", selected: @category_hashid },
          class: "form-select form-select-sm w-auto",
          onchange: "this.form.requestSubmit()"
      %select.form-select.form-select-sm.w-auto{ data: { "view-toggle-target": "select", action: "change->view-toggle#change" } }
        %option{ value: "list" } List View
        %option{ value: "small" } Small Cards
        %option{ value: "large" } Large Cards

  %ul.nav.nav-tabs.mb-4
    %li.nav-item
      = link_to listings_path(tab: "on_sale", category_id: @category_hashid), class: "nav-link #{"active" if @tab == "on_sale"}" do
        On Sale
    %li.nav-item
      = link_to listings_path(tab: "sold", category_id: @category_hashid), class: "nav-link #{"active" if @tab == "sold"}" do
        Sold

  - if @listings.empty? && @category_hashid
    = render EmptyStateComponent.new(icon: "funnel",
        message: "No listings found in that category.",
        link_text: "Clear filter and see all listings",
        link_url: listings_path(tab: @tab))

  - elsif @listings.empty? && @tab == "sold"
    = render EmptyStateComponent.new(icon: "tag",
        message: "No sold listings yet.",
        link_text: "Browse listings for sale",
        link_url: listings_path)
  - else
    %div{ data: { controller: "infinite-scroll" } }
      .row.row-cols-1.row-cols-sm-2.row-cols-md-3.row-cols-lg-4.g-4#listings{ data: { "view-toggle-target": "grid" } }
        = render partial: "listings/listing", collection: @listings, as: :listing
      = render "listings/sentinel", pagy: @pagy, category_id: @category_hashid, tab: @tab
