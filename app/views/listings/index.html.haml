%div{ data: { controller: "view-toggle" } }
  .d-flex.justify-content-between.align-items-center.mb-3
    %h1.h3.mb-0 Listings
    .d-flex.gap-2.align-items-center
      = form_with url: listings_path, method: :get do |f|
        = f.hidden_field :tab, value: @tab
        = f.select :category_id, @categories.map { [it.name, it.hashid] },
          { include_blank: "All Categories", selected: @category_hashid },
          class: "form-select form-select-sm w-auto",
          onchange: "this.form.requestSubmit()"
      %select.form-select.form-select-sm.w-auto{ data: { "view-toggle-target": "select", action: "change->view-toggle#change" } }
        %option{ value: "list" } List View
        %option{ value: "small" } Small Cards
        %option{ value: "large" } Large Cards

  %ul.nav.nav-tabs.mb-4
    %li.nav-item
      = link_to listings_path(tab: "on_sale", category_id: @category_hashid), class: "nav-link #{"active" if @tab == "on_sale"}" do
        On Sale
    %li.nav-item
      = link_to listings_path(tab: "sold", category_id: @category_hashid), class: "nav-link #{"active" if @tab == "sold"}" do
        Sold

  - if @listings.empty? && @category_hashid
    .text-center.py-5
      %p.text-muted.mb-2 No listings found in that category.
      = link_to listings_path(tab: @tab), class: "btn btn-outline-secondary btn-sm" do
        %i.bi.bi-x-circle.me-1
        Clear filter and see all listings

  - elsif @listings.empty? && @tab == "sold"
    .text-center.py-5
      %i.bi.bi-tag.text-muted.d-block.mb-3{ style: "font-size: 4rem" }
      %p.text-muted.mb-3 No sold listings yet.
      = link_to listings_path, class: "btn btn-primary" do
        Browse listings for sale

  - else
    %div{ data: { controller: "infinite-scroll" } }
      .row.row-cols-1.row-cols-sm-2.row-cols-md-3.row-cols-lg-4.g-4#listings{ data: { "view-toggle-target": "grid" } }
        = render partial: "listings/listing", collection: @listings, as: :listing
      = render "listings/sentinel", pagy: @pagy, category_id: @category_hashid, tab: @tab
